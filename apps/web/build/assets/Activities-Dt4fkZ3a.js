import{j as e,r as l,A as je,y as ge,C as Ce}from"./index-C6UZZE1B.js";import{D as L,f as S,T as we,r as J,C as ae,a as K,b as le,g as oe,c as Q,d as ee,t as ie,e as be,h as ce}from"./database-CL0enfGk.js";import{F as de,f as ue,a as me}from"./ErrorModal-DtsGE0Ou.js";import{C as U,a as W,b as Y,c as se,d as X}from"./CModalTitle-DyJ8safq.js";import{a as M,d as $,c as V}from"./index.esm-CaOeY0Rr.js";import{C as Ne,E as ye,a as ke,e as pe,b as De,c as Ie}from"./EditAssetsSection-OtVcqOaB.js";import{b as F,c as v,C as _,a as B,d as O}from"./CRow-BOoGTJLM.js";import{C as H,a as G,c as Ae,u as Te}from"./DefaultLayout-LzP_z8e3.js";import{c as Ee}from"./cil-lock-locked-DmxpJbVL.js";import"./CConditionalPortal-BWtFwqv2.js";import"./CCloseButton-B3bq1kyM.js";var Me=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M265.614,206.387H456V16H424V149.887L397.863,123.75c-79.539-79.539-208.96-79.54-288.5,0s-79.539,208.96,0,288.5a204.232,204.232,0,0,0,288.5,0l-22.627-22.627c-67.063,67.063-176.182,67.063-243.244,0s-67.063-176.183,0-243.246,176.182-67.063,243.245,0l28.01,28.01H265.614Z' class='ci-primary'/>"];const he=({showModal:s,setShowModal:o,activity:r,scheduledActivity:m,selectedClient:p,setScheduledActivities:D,setAllActivities:g,setFilteredActivities:x,isScheduled:u})=>{const j=new L,a=async()=>{if(r&&(r.id||m!=null&&m.id))try{if(u&&D&&m){await j.deleteScheduledActivity(m.id),o(!1);const h=await j.getScheduledActivities();D(h);return}else if(g&&!u){await j.deleteActivity(r),await j.deleteNotification(r),o(!1);const h=await j.getActivities();g(h),p&&x?x(h.filter(w=>w.parentDocId===p)):x&&x(h)}}catch(h){console.error("Failed to delete activity:",h)}};return e.jsxs(U,{scrollable:!0,alignment:"center",visible:s,backdrop:"static",size:"lg",onClose:()=>o(!1),children:[e.jsx(W,{children:e.jsxs(Y,{style:{fontSize:"2rem"},children:[e.jsx(de,{className:"me-2",icon:ue,color:"red"})," Delete Activity?"]})}),e.jsx(se,{className:"px-5",children:e.jsxs("div",{className:"py-3",children:[e.jsx("strong",{className:"d-block mb-3",children:"You are about to delete the activity with the following details:"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Recipient:"})," ",e.jsx("span",{children:r==null?void 0:r.recipient})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Time:"})," ",e.jsx("span",{children:r==null?void 0:r.formattedTime})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Amount:"})," ",e.jsx("span",{children:S(r==null?void 0:r.amount)})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Type:"})," ",e.jsx("span",{children:r==null?void 0:r.type})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Fund:"})," ",e.jsx("span",{children:r==null?void 0:r.fund})]}),e.jsx("strong",{className:"d-block mt-3 text-danger",children:"THIS ACTION IS IRREVERSIBLE."})]})}),e.jsxs(X,{children:[e.jsx(M,{color:"secondary",onClick:()=>o(!1),children:"Cancel"}),e.jsx(M,{color:"danger",variant:"outline",onClick:()=>a(),children:"Delete"})]})]})},q=(s,o)=>{let r=!0,m=[];return[{displayName:"Activity Amount",condition:s.amount<=0||isNaN(s.amount)},{displayName:"Fund",condition:s.fund===""},{displayName:"Recipient",condition:s.recipient===""},{displayName:"Time",condition:s.time===null},{displayName:"Type",condition:s.type===""}].forEach(({displayName:D,condition:g})=>{g&&(m.push(D),r=!1)}),o(m),r},fe=({activityState:s,setActivityState:o,clientState:r,setClientState:m,scheduledActivity:p,clientOptions:D,initialClientState:g,setInitialClientState:x})=>{const u=new L,j=s.time instanceof we?J(s.time.toDate()):J(s.time),a=n=>{if(!n)return"";const i=n.getFullYear(),c=String(n.getMonth()+1).padStart(2,"0"),f=String(n.getDate()).padStart(2,"0");return`${i}-${c}-${f}`},h=n=>{if(!n)return"";const i=String(n.getHours()).padStart(2,"0"),c=String(n.getMinutes()).padStart(2,"0");return`${i}:${c}`},[w,C]=l.useState(a(j)),[I,d]=l.useState(h(j)),[k,P]=l.useState(!0),A=(n,i)=>{if(!n||!i)return;const[c,f,b]=n.split("-").map(Number),[N,t]=i.split(":").map(Number),y=new Date;if(y.setFullYear(c,f-1,b),y.setHours(N,t,0,0),isNaN(y.getTime()))return;const E=J(y);o({...s,time:E})};l.useEffect(()=>{A(w,I)},[w,I]),l.useEffect(()=>{s.recipient===null||s.recipient===""||P(s.recipient==(r==null?void 0:r.firstName)+" "+(r==null?void 0:r.lastName))},[s.recipient,r]);const T=l.useMemo(()=>{if(!r)return[];let n=new Set;for(const c in r.assets)for(const f in r.assets[c]){const b=r.assets[c][f].displayTitle;b==="Personal"?n.add(`${r.firstName} ${r.lastName}`):n.add(b)}return[...n].map((c,f)=>({label:c,value:c}))},[r]);return e.jsxs(se,{children:[e.jsxs(F,{className:"mb-3 py-1 px-3",children:[e.jsx(v,{as:"label",htmlFor:"inputGroupSelect01",children:"Type"}),e.jsxs(ae,{id:"inputGroupSelect01",value:(s==null?void 0:s.type)!=""?s==null?void 0:s.type:"profit",onChange:n=>{o({...s,type:n.currentTarget.value}),console.log(r)},children:[e.jsx("option",{children:"Choose..."}),e.jsx("option",{value:"withdrawal",children:"Withdrawal"}),e.jsx("option",{value:"profit",children:"Profit"}),e.jsx("option",{value:"deposit",children:"Deposit"}),e.jsx("option",{value:"manual-entry",children:"Manual Entry"})]}),e.jsx("div",{className:"px-3"}),e.jsx(H,{className:"py-2",label:"Dividend Payment",id:"formSwitchCheckDisabled",disabled:s.type!=="profit",checked:s.isDividend,onChange:n=>{o({...s,isDividend:n.currentTarget.checked})}}),e.jsx("div",{className:"px-3"}),e.jsx(H,{className:"py-2",label:"Amortization Payment",id:"formSwitchCheckDisabled",disabled:s.type!=="profit"||s.amortizationCreated,checked:s.isAmortization,onChange:n=>{o({...s,isAmortization:n.currentTarget.checked,amortizationCreated:!1})}}),e.jsx("div",{className:"px-3"}),e.jsx(H,{className:"py-2",label:"Send Notification",id:"formSwitchCheckDisabled",checked:s.sendNotif,onChange:n=>{o({...s,sendNotif:n.currentTarget.checked})}})]}),e.jsx($,{className:"py-3 px-3",children:e.jsxs(_,{children:[e.jsx(B,{children:e.jsxs(F,{children:[e.jsx(v,{children:"Date"}),e.jsx(O,{type:"date",value:w,onChange:n=>C(n.target.value)})]})}),e.jsx(B,{children:e.jsxs(F,{children:[e.jsx(v,{children:"Time"}),e.jsx(O,{type:"time",value:I,onChange:n=>d(n.target.value)})]})}),e.jsx(B,{children:e.jsx(K,{id:"client",className:"mb-3a custom-multiselect-dropdown",options:D,defaultValue:r==null?void 0:r.cid,placeholder:"Select Client",selectAll:!1,multiple:!1,allowCreateOptions:!1,onChange:async n=>{if(n.length===0)return;const i=n.map(b=>b.value)[0],c=n.map(b=>b.label)[0],f=await u.getClient(i);if(x(structuredClone(f)),f){const b=p==null?void 0:p.changedAssets,N=structuredClone(f);m(b?le(N,b):N),o(k?{...s,recipient:c,parentDocId:i,parentName:c}:{...s,parentDocId:i,parentName:c})}}})})]})}),e.jsx($,{className:"py-3 px-3",children:e.jsxs(_,{children:[e.jsx(B,{xl:4,children:e.jsx(F,{children:e.jsx(Ne,{placement:"left",content:"Sometimes you may need the recipient of the activity to differ from the client who's activity it is. Uncheck this box to type a different recipient.",children:e.jsx(H,{id:"sameAsClientCheckbox",label:"Recipient is the same as the client",checked:k,onChange:n=>{P(n.target.checked),console.log(s)}})})})}),e.jsx(B,{xl:8,children:e.jsx(K,{id:"recipient",className:"mb-3a custom-multiselect-dropdown",options:T,placeholder:"Select Recipient",multiple:!1,disabled:k,defaultValue:s.recipient,onChange:n=>{const i=n.map(c=>c.value)[0];o({...s,recipient:i})}})})]})}),e.jsxs(F,{className:"mb-3 py-3 px-3",children:[e.jsx(v,{as:"label",htmlFor:"inputGroupSelect01",children:"Fund"}),e.jsxs(ae,{id:"inputGroupSelect01",defaultValue:"ARMM",value:s.fund!=""?s.fund:void 0,onChange:n=>{o({...s,fund:n.currentTarget.value})},children:[e.jsx("option",{children:"Choose..."}),e.jsx("option",{value:"ARMM",children:"ARMM"})]}),e.jsx(v,{children:"Amount"}),e.jsx(v,{children:"$"}),e.jsx(O,{id:"amount",type:"number",step:"1000",value:s.amount,onChange:n=>{const i=n.target.value;if(/^\d*\.?\d{0,2}$/.test(i)){const c={...s,amount:parseFloat(i)};o(c)}},onBlur:n=>{const i=n.target.value;if(i===""||isNaN(parseFloat(i))){const c={...s,amount:0};o(c)}}})]}),r&&s.isAmortization&&!s.amortizationCreated&&e.jsxs(F,{className:"mb-3 py-3 px-3",children:[e.jsx(v,{children:"Principal Paid"}),e.jsx(v,{children:"$"}),e.jsx(O,{id:"amount",type:"number",step:"1000",value:s.principalPaid,disabled:s.amortizationCreated,onChange:n=>{const i=n.target.value;if(/^\d*\.?\d{0,2}$/.test(i)){const c={...s,principalPaid:parseFloat(i),profitPaid:s.amount-parseFloat(i)};o(c)}},onBlur:n=>{const i=n.target.value;if(i===""||isNaN(parseFloat(i))){const c={...s,principalPaid:0,profitPaid:s.amount};o(c)}}}),e.jsx(v,{children:"Profit Paid"}),e.jsx(v,{children:"$"}),e.jsx(O,{id:"amount",type:"number",step:"1000",value:s.profitPaid,disabled:!0})]}),r&&((s.isDividend||s.isAmortization)&&s.type==="profit"||s.type==="manual-entry"||s.type==="deposit"||s.type==="withdrawal")&&s.fund&&!s.amortizationCreated&&e.jsx(ye,{clientState:r,setClientState:m,activeFund:s.fund,incrementAmount:s.isAmortization?s.principalPaid:s.amount}),e.jsx($,{className:"py-3 px-3",children:e.jsx(_,{children:e.jsx(B,{children:e.jsxs(F,{children:[e.jsx(v,{children:"Notes"}),e.jsx(ke,{id:"notes",value:s.notes,placeholder:"Enter notes here...",onChange:n=>{o({...s,notes:n.target.value})}})]})})})})]})},xe=({showModal:s,setShowModal:o,clients:r,activity:m,scheduledActivity:p,selectedClient:D,setAllActivities:g,setFilteredActivities:x,setScheduledActivities:u,isScheduled:j=!1})=>{const a=new L,[h,w]=l.useState(m??pe),[C,I]=l.useState(De),[d,k]=l.useState(!1),[P,A]=l.useState([]),[T,n]=l.useState(!1),i=r.map(N=>({value:N.cid,label:N.firstName+" "+N.lastName,selected:(m==null?void 0:m.parentDocId)===N.cid})).sort((N,t)=>N.label.localeCompare(t.label)),[c,f]=l.useState(null);l.useEffect(()=>{console.log("Initial Client State: ",c)},[c]),l.useEffect(()=>{(async()=>{if(T){if(!q(h,A)){k(!0);return}if(T&&w({...h,time:new Date}),!C||!c){console.error("Invalid client state"),alert("Invalid client state");return}await b((p==null?void 0:p.id)??"",h,c,C,j),o(!1);const t=await a.getActivities();g&&g(t),x&&x(t.filter(y=>y.parentDocId===(D??C.cid)))}})()},[T]),l.useEffect(()=>{(async()=>{try{let t=await a.getClient(h.parentDocId??"");if(!t){console.error("Client state not found"),alert("Client state not found");return}f(t),console.log("Initial Client State: ",c);const y=p==null?void 0:p.changedAssets;y&&I(le(t,y))}catch(t){console.error("Failed to fetch client:",t)}})()},[]);const b=async(N,t,y,E,ne)=>{const z=new L,Z=oe(y,E);if(console.log("Activity State: ",p),t.isAmortization===!0&&!t.amortizationCreated){let R=[];const[re,te]=Q(t,E);ne?(R.push(z.scheduleActivity(re,E,Z)),R.push(z.scheduleActivity(te,E,Z)),R.push(z.deleteScheduledActivity(t.id))):(R.push(z.createActivity(re,E.cid)),R.push(z.createActivity(te,E.cid)),R.push(z.deleteActivity(t)),R.push(z.setAssets(E))),await Promise.all(R);return}else if(ne&&p){await z.updateScheduledActivity(N,t,E,Z);return}await z.setActivity(t,{activityDocId:t.id},E.cid),(t.isDividend||t.type==="manual-entry"||t.type==="deposit"||t.type==="withdrawal")&&E&&await z.setAssets(E)};return e.jsxs(e.Fragment,{children:[d&&e.jsx(me,{showErrorModal:d,setShowErrorModal:k,invalidInputFields:P,setOverride:n}),e.jsxs(U,{scrollable:!0,visible:s,backdrop:"static",size:"xl",alignment:"center",onClose:()=>o(!1),children:[e.jsx(W,{closeButton:!0,children:e.jsx(Y,{children:"Edit Activity"})}),e.jsx(fe,{activityState:h,setActivityState:w,clientState:C,setClientState:I,scheduledActivity:p,clientOptions:i,initialClientState:c,setInitialClientState:f}),e.jsxs(X,{children:[e.jsx(M,{color:"secondary",variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(M,{color:"primary",onClick:async()=>{if(!q(h,A)){k(!0);return}if(T&&w({...h,time:new Date}),!C||!c){console.error("Invalid client state"),alert("Invalid client state");return}if(await b(p==null?void 0:p.id,h,c,C,j),o(!1),u){const t=await a.getScheduledActivities();u(t)}const N=await a.getActivities();g&&g(N),x&&x(N.filter(t=>t.parentDocId===(D??C.cid)))},children:"Update"})]})]})]})},Pe=({showModal:s,setShowModal:o,selectedActivities:r,setSelectedActivities:m,allActivities:p,setAllActivities:D,filteredActivities:g,setFilteredActivities:x,selectedClient:u})=>{const[j,a]=l.useState(""),[h,w]=l.useState(""),C=je(),I=new L,[d,k]=l.useState(!1),P=[{key:"type",label:"Type"},{key:"parentName",label:"Client"},{key:"amount",label:"Amount"},{key:"recipient",label:"Recipient"},{key:"formattedTime",label:"Time"}],A=n=>{switch(n.toLowerCase()){case"deposit":return"success";case"profit":case"income":return"info";case"pending":return"warning";case"withdrawal":return"danger";default:return"primary"}},T=async()=>{var n;try{if(k(!0),!((n=C.currentUser)!=null&&n.email)){w("No authenticated user found");return}await ge(C,C.currentUser.email,j);for(const i of r)await I.deleteActivity(i),await I.deleteNotification(i);m([]),k(!1),o(!1),D(p.filter(i=>!r.find(c=>c.id===i.id))),x(g.filter(i=>!r.find(c=>c.id===i.id)))}catch(i){w("Incorrect password"),console.error("Failed to delete selected activities:",i)}};return e.jsxs(U,{visible:s,onClose:()=>o(!1),size:"xl",alignment:"center",scrollable:!0,children:[e.jsxs(W,{children:[e.jsx(de,{className:"me-3",icon:ue,color:"red",size:"xl"}),e.jsx(Y,{style:{fontSize:"2rem"},children:"Delete Selected Transactions?"})]}),e.jsxs(se,{children:[e.jsx("div",{className:"mb-3",children:e.jsx("strong",{children:"Are you sure you want to delete the following transactions?"})}),e.jsx(ee,{items:r,columns:P,columnSorter:!0,pagination:!0,itemsPerPage:10,scopedColumns:{type:n=>e.jsx("td",{children:e.jsx(G,{color:A(n.type),children:ie(n.type)})}),amount:n=>e.jsx("td",{children:S(n.amount)})}}),e.jsxs("div",{className:"mt-4",children:[e.jsx("strong",{className:"d-block mb-3",children:"Please enter your password to confirm deletion:"}),e.jsxs(F,{className:"mb-3",children:[e.jsx(v,{children:e.jsx(V,{icon:Ee})}),e.jsx(O,{type:"password",placeholder:"Enter your password",value:j,onChange:n=>{a(n.target.value),w("")},invalid:!!h,autoComplete:"off"})]}),h&&e.jsx("div",{className:"text-danger mb-3",children:h})]}),e.jsx("strong",{className:"d-block mt-3 text-danger",children:"THIS ACTION IS IRREVERSIBLE."})]}),e.jsxs(X,{children:[e.jsx(M,{color:"secondary",onClick:()=>o(!1),children:"Cancel"}),e.jsx(be,{color:"danger",variant:"outline",onClick:T,disabled:!j,loading:d,children:"Confirm Delete"})]})]})},ve=({allActivities:s,setAllActivities:o,filteredActivities:r,setFilteredActivities:m,clients:p,setClients:D,selectedClient:g,setSelectedClient:x})=>{const[u,j]=l.useState(!1),[a,h]=l.useState(p.map(t=>({value:t.cid,label:t.firstName+" "+t.lastName})).sort((t,y)=>t.label.localeCompare(y.label))),[w,C]=l.useState(!1),[I,d]=l.useState(!1),[k,P]=l.useState(!1),[A,T]=l.useState([]),[n,i]=l.useState(!1),[c,f]=l.useState(void 0);l.useEffect(()=>{A.length>0?P(!0):P(!1)},[A]);const b=[{key:"type",label:"Type",sorter:!1},{key:"parentName",label:"Client"},{label:"Time",key:"formattedTime",_style:{width:"25%"}},{key:"recipient",label:"Recipient"},{key:"amount",label:"Amount"},{key:"fund",_style:{width:"10%"}},{key:"edit",label:"",_style:{width:"1%"},filter:!1,sorter:!1},{key:"delete",label:"",_style:{width:"1%"},filter:!1,sorter:!1}],N=t=>{switch(t.toLowerCase()){case"deposit":return"success";case"profit":return"info";case"income":return"info";case"pending":return"warning";case"withdrawal":return"danger";default:return"primary"}};return e.jsxs($,{children:[I&&e.jsx(he,{showModal:I,setShowModal:d,activity:c,selectedClient:g,setAllActivities:o,setFilteredActivities:m}),w&&e.jsx(xe,{showModal:w,setShowModal:C,clients:p,activity:c,selectedClient:g,setAllActivities:o,setFilteredActivities:m}),n&&e.jsx(Pe,{showModal:n,setShowModal:i,selectedActivities:A,setSelectedActivities:T,allActivities:s,setAllActivities:o,filteredActivities:r,setFilteredActivities:m,selectedClient:g}),k&&e.jsx("div",{style:{position:"fixed",bottom:"20px",left:"58%",transform:"translateX(-50%)",zIndex:999,boxShadow:"2px 5px 5px rgba(0, 0, 0, 0.2)"},children:e.jsxs(M,{style:{backgroundColor:u?"#D1464B":"#191C25",boxShadow:"2px 4px 4px rgba(0, 0, 0, 0.05)",borderColor:"#D1464B",borderWidth:"1.5px",padding:"8px 72px",fontSize:"1.1rem"},className:u?"text-light":"text-danger",onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),onClick:()=>i(!0),children:[e.jsx(V,{icon:ce,className:"me-2"})," Delete ",A.length," ",A.length>1?"Activities":"Activity"]})}),e.jsxs(_,{className:"justify-content-center py-3",children:[e.jsx(B,{children:e.jsx(K,{id:"client",className:"mb-3a custom-multiselect-dropdown",options:a,placeholder:"Type or select a specific client to view activities for",selectAll:!1,multiple:!1,optionsStyle:"text",allowCreateOptions:!1,onChange:async t=>{let y;t.length>0?y=t[0].value:console.log("Selections cleared"),x(y),m(y?s.filter(E=>E.parentDocId===y):s)}})}),e.jsx(B,{xl:2,style:{float:"left"},children:e.jsxs(M,{color:"danger",variant:"outline",shape:"square",className:"w-100",onClick:()=>{h(t=>t.map(y=>y.value===g?{...y,selected:!1}:y)),m(s)},children:["Reset ",e.jsx(V,{icon:Me})]})})]}),e.jsx(ee,{activePage:1,cleaner:!0,clickableRows:!0,columns:b,columnFilter:!0,columnSorter:!0,items:r,itemsPerPageSelect:!0,itemsPerPage:20,pagination:!0,sorterValue:{column:"formattedTime",state:"desc"},selectable:!0,selected:A,onSelectedItemsChange:t=>{T(t)},scopedColumns:{type:t=>e.jsx("td",{children:e.jsx(G,{color:N(t.type),children:ie(t.type)})}),amount:t=>e.jsx("td",{children:S(t.amount)}),edit:t=>e.jsx("td",{className:"py-2",children:e.jsx(M,{color:"warning",variant:"outline",shape:"square",size:"sm",onClick:async()=>{f(t),C(!0)},children:"Edit"})}),delete:t=>e.jsx("td",{className:"py-2",children:e.jsx(M,{color:"danger",variant:"outline",shape:"square",size:"sm",onClick:()=>{f(t),d(!0)},children:"Delete"})})}})]})},ze=({scheduledActivities:s,setScheduledActivities:o,clients:r,setClients:m})=>{const[p,D]=l.useState(void 0),[g,x]=l.useState(!1),[u,j]=l.useState(!1),[a,h]=l.useState(void 0),w=[{key:"type",label:"Type",sorter:!1},{key:"parentName",label:"Client"},{label:"Scheduled Time",key:"formattedTime",_style:{width:"20%"}},{key:"recipient",label:"Recipient"},{key:"amount",label:"Amount"},{key:"status",label:"Status",_style:{width:"8%"}},{key:"fund",_style:{width:"7%"}},{key:"edit",label:"",_style:{width:"1%"},filter:!1,sorter:!1},{key:"delete",label:"",_style:{width:"1%"},filter:!1,sorter:!1}],C=d=>{switch(d.toLowerCase()){case"deposit":return"success";case"profit":return"info";case"income":return"info";case"pending":return"warning";case"withdrawal":return"danger";case"completed":return"success";default:return"primary"}};function I(d){return d.charAt(0).toUpperCase()+d.slice(1).toLowerCase()}return e.jsxs($,{children:[e.jsx("h1",{className:"pt-5 pb-2",children:"Scheduled Activities"}),g&&e.jsx(he,{showModal:g,setShowModal:x,activity:a==null?void 0:a.activity,scheduledActivity:a,isScheduled:!0,selectedClient:p,setScheduledActivities:o}),u&&e.jsx(xe,{showModal:u,setShowModal:j,clients:r,activity:a==null?void 0:a.activity,scheduledActivity:a,isScheduled:!0,selectedClient:p,setScheduledActivities:o}),e.jsx(ee,{activePage:1,cleaner:!0,clickableRows:!0,columns:w,columnFilter:!0,columnSorter:!0,items:s,itemsPerPageSelect:!0,itemsPerPage:20,pagination:!0,sorterValue:{column:"formattedTime",state:"desc"},scopedColumns:{type:d=>e.jsx("td",{children:e.jsx(G,{color:C(d.activity.type),children:I(d.activity.type)})}),parentName:d=>e.jsx("td",{children:d.activity.parentName}),scheduledTime:d=>e.jsx("td",{children:d.formattedTime}),recipient:d=>e.jsx("td",{children:d.activity.recipient}),amount:d=>e.jsx("td",{children:S(d.activity.amount)}),status:d=>e.jsx("td",{children:e.jsx(G,{color:C(d.status),children:I(d.status)})}),fund:d=>e.jsx("td",{children:d.activity.fund}),edit:d=>e.jsx("td",{className:"py-2",children:e.jsx(M,{color:"warning",variant:"outline",shape:"square",size:"sm",disabled:d.status==="completed",onClick:async()=>{h(d),j(!0),D(d.cid)},children:"Edit"})}),delete:d=>e.jsx("td",{className:"py-2",children:e.jsx(M,{color:"danger",variant:"outline",shape:"square",size:"sm",onClick:()=>{h(d),x(!0),D(d.cid)},children:"Delete"})})}})]})},Re=({showModal:s,setShowModal:o,clients:r,selectedClient:m,setAllActivities:p,setFilteredActivities:D,setScheduledActivities:g})=>{const x=new L,[u,j]=l.useState(pe),[a,h]=l.useState((r==null?void 0:r.find(f=>f.cid===m))??null),[w,C]=l.useState(!1),[I,d]=l.useState([]),[k,P]=l.useState(!1),A=r.map(f=>({value:f.cid,label:f.firstName+" "+f.lastName,selected:m===f.cid})).sort((f,b)=>f.label.localeCompare(b.label)),[T,n]=l.useState(null),i=async()=>{if(!q(u,d)&&!k)C(!0);else{if(k&&j({...u,time:new Date}),!a){console.error("Invalid client state"),alert("Please select a client.");return}if(u.isAmortization===!0&&!u.amortizationCreated){const[b,N]=Q(u,a);let t=[];t.push(x.createActivity(b,a.cid)),t.push(x.createActivity(N,a.cid)),t.push(x.setAssets(a)),await Promise.all(t)}else await x.createActivity({...u,parentName:a.firstName+" "+a.lastName},a.cid),(u.isDividend||u.type==="manual-entry"||u.type==="deposit"||u.type==="withdrawal")&&a&&await x.setAssets(a);o(!1);const f=await x.getActivities();p(f),D(f.filter(b=>b.parentDocId===(m??a.cid)))}},c=async()=>{if(!a||!T){console.error("Invalid client state"),alert("Please select a client.");return}const f=oe(T,a);if(!q(u,d)&&!k)C(!0);else{if(k&&j({...u,time:new Date}),u.time<=new Date){alert("Scheduled time must be in the future.");return}if(!a){console.error("Invalid client state");return}if(u.isAmortization===!0&&!u.amortizationCreated){const[t,y]=Q(u,a);await x.scheduleActivity(t,a,f),await x.scheduleActivity(y,a,f)}else await x.scheduleActivity(u,a,f);o(!1);const b=await x.getActivities();p(b);const N=await x.getScheduledActivities();g(N),D(b.filter(t=>t.parentDocId===(m??a.cid)))}};return l.useEffect(()=>{(async()=>{k&&await i()})()},[k]),e.jsxs(e.Fragment,{children:[w&&e.jsx(me,{showErrorModal:w,setShowErrorModal:C,invalidInputFields:I,setOverride:P}),e.jsxs(U,{scrollable:!0,visible:s,backdrop:"static",size:"xl",alignment:"center",onClose:()=>o(!1),children:[e.jsx(W,{closeButton:!0,children:e.jsx(Y,{children:"Create New Activity"})}),e.jsx(fe,{activityState:u,setActivityState:j,clientState:a,setClientState:h,clientOptions:A,initialClientState:T,setInitialClientState:n}),e.jsxs(X,{children:[e.jsxs(M,{color:"primary",onClick:i,children:[e.jsx(V,{icon:Ie,className:"me-2"}),"Create"]}),e.jsxs(M,{color:"primary",variant:"outline",onClick:c,children:[e.jsx(V,{icon:Ae,className:"me-2"}),"Schedule"]}),e.jsxs(M,{color:"danger",variant:"outline",onClick:()=>{o(!1)},children:[e.jsx(V,{icon:ce,className:"me-2"}),"Discard"]})]})]})]})},Ue=()=>{const{t:s}=Te(),[o,r]=l.useState(!0),[m,p]=l.useState(!1),[D,g]=l.useState([]),[x,u]=l.useState([]),[j,a]=l.useState([]),[h,w]=l.useState([]),[C,I]=l.useState();return l.useEffect(()=>{(async()=>{const k=new L,P=await k.getActivities(),A=await k.getScheduledActivities(),T=await k.getClients();a(A),u(P),g(P),w(T),r(!1)})()},[]),o?e.jsx("div",{className:"text-center",children:e.jsx(Ce,{color:"primary"})}):e.jsxs("div",{children:[m&&e.jsx(Re,{showModal:m,setShowModal:p,clients:h,selectedClient:C,setAllActivities:g,setFilteredActivities:u,setScheduledActivities:a}),e.jsx("div",{className:"d-grid gap-2 py-3",children:e.jsx(M,{color:"primary",onClick:()=>p(!0),children:"Add Transaction +"})}),e.jsx(ve,{allActivities:D,setAllActivities:g,filteredActivities:x,setFilteredActivities:u,clients:h,setClients:w,selectedClient:C,setSelectedClient:I}),e.jsx(ze,{scheduledActivities:j,setScheduledActivities:a,clients:h,setClients:w})]})};export{Ue as default};
