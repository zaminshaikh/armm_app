import{j as e,r as a,B as xe,x as je,C as re}from"./index-XZRXeKYy.js";import{D as z,f as q,T as ge,r as Z,C as se,a as J,b as K,c as Q,t as te,d as we,e as ae}from"./database-CsVTft8U.js";import{F as le,f as oe,a as ie}from"./ErrorModal-DQjN0NP_.js";import{C as U,a as W,b as Y,c as S,d as X}from"./CModalTitle-D13ujpG6.js";import{a as v,d as O,c as F}from"./index.esm-Btfu6nMy.js";import{C as Ce,E as be,a as ye,e as ce,b as Ne,c as Ae}from"./EditAssetsSection-BE7WQTXv.js";import{C as M,a as T,b as R}from"./CInputGroupText-DUWUW7j8.js";import{C as V,a as _,c as ke,u as De}from"./DefaultLayout-BdRLv_tp.js";import{C as H,a as P}from"./CRow--Mb2BLLo.js";import{c as Ie}from"./cil-lock-locked-DmxpJbVL.js";import"./CConditionalPortal-er86fRMf.js";var ve=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M265.614,206.387H456V16H424V149.887L397.863,123.75c-79.539-79.539-208.96-79.54-288.5,0s-79.539,208.96,0,288.5a204.232,204.232,0,0,0,288.5,0l-22.627-22.627c-67.063,67.063-176.182,67.063-243.244,0s-67.063-176.183,0-243.246,176.182-67.063,243.245,0l28.01,28.01H265.614Z' class='ci-primary'/>"];const de=({showModal:s,setShowModal:t,activity:r,selectedClient:l,setScheduledActivities:f,setAllActivities:g,setFilteredActivities:p,isScheduled:j})=>{const u=new z,C=async()=>{if(r&&r.id)try{if(j&&f){await u.deleteScheduledActivity(r.id),t(!1);const o=await u.getScheduledActivities();f(o);return}else if(g){await u.deleteActivity(r),await u.deleteNotification(r),t(!1);const o=await u.getActivities();g(o),l&&p?p(o.filter(h=>h.parentDocId===l)):p&&p(o)}}catch(o){console.error("Failed to delete activity:",o)}};return e.jsxs(U,{scrollable:!0,alignment:"center",visible:s,backdrop:"static",size:"lg",onClose:()=>t(!1),children:[e.jsx(W,{children:e.jsxs(Y,{style:{fontSize:"2rem"},children:[e.jsx(le,{className:"me-2",icon:oe,color:"red"})," Delete Activity?"]})}),e.jsx(S,{className:"px-5",children:e.jsxs("div",{className:"py-3",children:[e.jsx("strong",{className:"d-block mb-3",children:"You are about to delete the activity with the following details:"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Recipient:"})," ",e.jsx("span",{children:r==null?void 0:r.recipient})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Time:"})," ",e.jsx("span",{children:r==null?void 0:r.formattedTime})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Amount:"})," ",e.jsx("span",{children:q(r==null?void 0:r.amount)})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Type:"})," ",e.jsx("span",{children:r==null?void 0:r.type})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Fund:"})," ",e.jsx("span",{children:r==null?void 0:r.fund})]}),e.jsx("strong",{className:"d-block mt-3 text-danger",children:"THIS ACTION IS IRREVERSIBLE."})]})}),e.jsxs(X,{children:[e.jsx(v,{color:"secondary",onClick:()=>t(!1),children:"Cancel"}),e.jsx(v,{color:"danger",variant:"outline",onClick:()=>C(),children:"Delete"})]})]})},G=(s,t)=>{let r=!0,l=[];return[{displayName:"Activity Amount",condition:s.amount<=0||isNaN(s.amount)},{displayName:"Fund",condition:s.fund===""},{displayName:"Recipient",condition:s.recipient===""},{displayName:"Time",condition:s.time===null},{displayName:"Type",condition:s.type===""}].forEach(({displayName:g,condition:p})=>{p&&(l.push(g),r=!1)}),t(l),r},ue=({activityState:s,setActivityState:t,clientState:r,setClientState:l,clientOptions:f})=>{const g=new z,p=s.time instanceof ge?Z(s.time.toDate()):Z(s.time),j=n=>{if(!n)return"";const c=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0"),m=String(n.getDate()).padStart(2,"0");return`${c}-${i}-${m}`},u=n=>{if(!n)return"";const c=String(n.getHours()).padStart(2,"0"),i=String(n.getMinutes()).padStart(2,"0");return`${c}:${i}`},[C,o]=a.useState(j(p)),[h,N]=a.useState(u(p)),[w,D]=a.useState(!0),I=(n,c)=>{if(!n||!c)return;console.log(`New Date: ${n}, New Time: ${c}`);const[i,m,d]=n.split("-").map(Number),[x,b]=c.split(":").map(Number),k=new Date;if(k.setFullYear(i,m-1,d),k.setHours(x,b,0,0),isNaN(k.getTime()))return;const B=Z(k);console.log(`Rounded Date: ${B}`),t({...s,time:B})};a.useEffect(()=>{I(C,h)},[C,h]),a.useEffect(()=>{s.recipient===null||s.recipient===""||(console.log(s),D(s.recipient==(r==null?void 0:r.firstName)+" "+(r==null?void 0:r.lastName)))},[s.recipient,r]);const y=a.useMemo(()=>{if(!r)return[];let n=new Set;for(const i in r.assets)for(const m in r.assets[i]){const d=r.assets[i][m].displayTitle;d==="Personal"?n.add(`${r.firstName} ${r.lastName}`):n.add(d)}return[...n].map((i,m)=>({label:i,value:i}))},[r]);return e.jsxs(S,{children:[e.jsxs(M,{className:"mb-3 py-1 px-3",children:[e.jsx(T,{as:"label",htmlFor:"inputGroupSelect01",children:"Type"}),e.jsxs(se,{id:"inputGroupSelect01",value:(s==null?void 0:s.type)!=""?s==null?void 0:s.type:"profit",onChange:n=>{t({...s,type:n.currentTarget.value}),console.log(r)},children:[e.jsx("option",{children:"Choose..."}),e.jsx("option",{value:"withdrawal",children:"Withdrawal"}),e.jsx("option",{value:"profit",children:"Profit"}),e.jsx("option",{value:"deposit",children:"Deposit"}),e.jsx("option",{value:"manual-entry",children:"Manual Entry"})]}),e.jsx("div",{className:"px-3"}),e.jsx(V,{className:"py-2",label:"Dividend Payment",id:"formSwitchCheckDisabled",disabled:s.type!=="profit",checked:s.isDividend,onChange:n=>{t({...s,isDividend:n.currentTarget.checked})}}),e.jsx("div",{className:"px-3"}),e.jsx(V,{className:"py-2",label:"Amortization Payment",id:"formSwitchCheckDisabled",disabled:s.type!=="profit"||s.amortizationCreated,checked:s.isAmortization,onChange:n=>{t({...s,isAmortization:n.currentTarget.checked,amortizationCreated:!1})}}),e.jsx("div",{className:"px-3"}),e.jsx(V,{className:"py-2",label:"Send Notification",id:"formSwitchCheckDisabled",checked:s.sendNotif,onChange:n=>{t({...s,sendNotif:n.currentTarget.checked})}})]}),e.jsx(O,{className:"py-3 px-3",children:e.jsxs(H,{children:[e.jsx(P,{children:e.jsxs(M,{children:[e.jsx(T,{children:"Date"}),e.jsx(R,{type:"date",value:C,onChange:n=>o(n.target.value)})]})}),e.jsx(P,{children:e.jsxs(M,{children:[e.jsx(T,{children:"Time"}),e.jsx(R,{type:"time",value:h,onChange:n=>N(n.target.value)})]})}),e.jsx(P,{children:e.jsx(J,{id:"client",className:"mb-3a custom-multiselect-dropdown",options:f,defaultValue:r==null?void 0:r.cid,placeholder:"Select Client",selectAll:!1,multiple:!1,allowCreateOptions:!1,onChange:async n=>{if(n.length===0)return;const c=n.map(d=>d.value)[0],i=n.map(d=>d.label)[0],m=await g.getClient(c);m&&(l(m),t(w?{...s,recipient:i,parentDocId:c,parentName:i}:{...s,parentDocId:c,parentName:i}))}})})]})}),e.jsx(O,{className:"py-3 px-3",children:e.jsxs(H,{children:[e.jsx(P,{xl:4,children:e.jsx(M,{children:e.jsx(Ce,{placement:"left",content:"Sometimes you may need the recipient of the activity to differ from the client who's activity it is. Uncheck this box to type a different recipient.",children:e.jsx(V,{id:"sameAsClientCheckbox",label:"Recipient is the same as the client",checked:w,onChange:n=>{D(n.target.checked),console.log(s)}})})})}),e.jsx(P,{xl:8,children:e.jsx(J,{id:"recipient",className:"mb-3a custom-multiselect-dropdown",options:y,placeholder:"Select Recipient",multiple:!1,disabled:w,defaultValue:s.recipient,onChange:n=>{const c=n.map(i=>i.value)[0];t({...s,recipient:c})}})})]})}),e.jsxs(M,{className:"mb-3 py-3 px-3",children:[e.jsx(T,{as:"label",htmlFor:"inputGroupSelect01",children:"Fund"}),e.jsxs(se,{disabled:!0,id:"inputGroupSelect01",defaultValue:"ARMM",value:s.fund!=""?s.fund:void 0,onChange:n=>{t({...s,fund:n.currentTarget.value})},children:[e.jsx("option",{children:"Choose..."}),e.jsx("option",{value:"ARMM",children:"ARMM"})]}),e.jsx(T,{children:"Amount"}),e.jsx(T,{children:"$"}),e.jsx(R,{id:"amount",type:"number",step:"1000",value:s.amount,onChange:n=>{const c=n.target.value;if(/^\d*\.?\d{0,2}$/.test(c)){const i={...s,amount:parseFloat(c)};t(i)}},onBlur:n=>{const c=n.target.value;if(c===""||isNaN(parseFloat(c))){const i={...s,amount:0};t(i)}}})]}),r&&s.isAmortization&&!s.amortizationCreated&&e.jsxs(M,{className:"mb-3 py-3 px-3",children:[e.jsx(T,{children:"Principal Paid"}),e.jsx(T,{children:"$"}),e.jsx(R,{id:"amount",type:"number",step:"1000",value:s.principalPaid,disabled:s.amortizationCreated,onChange:n=>{const c=n.target.value;if(/^\d*\.?\d{0,2}$/.test(c)){const i={...s,principalPaid:parseFloat(c),profitPaid:s.amount-parseFloat(c)};t(i)}},onBlur:n=>{const c=n.target.value;if(c===""||isNaN(parseFloat(c))){const i={...s,principalPaid:0,profitPaid:s.amount};t(i)}}}),e.jsx(T,{children:"Profit Paid"}),e.jsx(T,{children:"$"}),e.jsx(R,{id:"amount",type:"number",step:"1000",value:s.profitPaid,disabled:!0})]}),r&&((s.isDividend||s.isAmortization)&&s.type==="profit"||s.type==="manual-entry"||s.type==="deposit"||s.type==="withdrawal")&&s.fund&&!s.amortizationCreated&&e.jsx(be,{clientState:r,setClientState:l,activeFund:s.fund,incrementAmount:s.isAmortization?s.principalPaid:s.amount}),e.jsx(O,{className:"py-3 px-3",children:e.jsx(H,{children:e.jsx(P,{children:e.jsxs(M,{children:[e.jsx(T,{children:"Notes"}),e.jsx(ye,{id:"notes",value:s.notes,placeholder:"Enter notes here...",onChange:n=>{t({...s,notes:n.target.value})}})]})})})})]})},ne=async(s,t,r)=>{const l=new z;if(s.isAmortization===!0&&!s.amortizationCreated){let f=[];const[g,p]=K(s,t);r?(f.push(l.scheduleActivity(g,t)),f.push(l.scheduleActivity(p,t)),f.push(l.deleteScheduledActivity(s.id))):(f.push(l.createActivity(g,t.cid)),f.push(l.createActivity(p,t.cid)),f.push(l.deleteActivity(s)),f.push(l.setAssets(t))),await Promise.all(f);return}else if(r&&s.id){await l.updateScheduledActivity(s,t);return}await l.setActivity(s,{activityDocId:s.id},t.cid),(s.isDividend||s.type==="manual-entry"||s.type==="deposit"||s.type==="withdrawal")&&t&&await l.setAssets(t)},me=({showModal:s,setShowModal:t,clients:r,activity:l,selectedClient:f,setAllActivities:g,setFilteredActivities:p,setScheduledActivities:j,onSubmit:u=ne,isScheduled:C=!1})=>{const o=new z,[h,N]=a.useState(l??ce),[w,D]=a.useState(Ne),[I,y]=a.useState(!1),[n,c]=a.useState([]),[i,m]=a.useState(!1),d=r.map(x=>({value:x.cid,label:x.firstName+" "+x.lastName,selected:(l==null?void 0:l.parentDocId)===x.cid})).sort((x,b)=>x.label.localeCompare(b.label));return a.useEffect(()=>{(async()=>{if(i){if(!G(h,c)){y(!0);return}if(i&&N({...h,time:new Date}),!w){console.error("Invalid client state");return}await ne(h,w,C),t(!1);const b=await o.getActivities();g&&g(b),p&&p(b.filter(k=>k.parentDocId===(f??w.cid)))}})()},[i]),a.useEffect(()=>{(async()=>{try{console.log("Fetching client:",h.parentDocId);const b=await o.getClient(h.parentDocId??"");D(b)}catch(b){console.error("Failed to fetch client:",b)}})()},[]),console.log("Activity state changed:",h),e.jsxs(e.Fragment,{children:[I&&e.jsx(ie,{showErrorModal:I,setShowErrorModal:y,invalidInputFields:n,setOverride:m}),e.jsxs(U,{scrollable:!0,visible:s,backdrop:"static",size:"xl",alignment:"center",onClose:()=>t(!1),children:[e.jsx(W,{closeButton:!0,children:e.jsx(Y,{children:"Edit Activity"})}),e.jsx(ue,{activityState:h,setActivityState:N,clientState:w,setClientState:D,clientOptions:d}),e.jsxs(X,{children:[e.jsx(v,{color:"secondary",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsx(v,{color:"primary",onClick:async()=>{if(!G(h,c)){y(!0);return}if(i&&N({...h,time:new Date}),!w){console.error("Invalid client state");return}if(await u(h,w,C),t(!1),j){const b=await o.getScheduledActivities();j(b)}const x=await o.getActivities();g&&g(x),p&&p(x.filter(b=>b.parentDocId===(f??w.cid)))},children:"Update"})]})]})]})},Te=({showModal:s,setShowModal:t,selectedActivities:r,setSelectedActivities:l,allActivities:f,setAllActivities:g,filteredActivities:p,setFilteredActivities:j,selectedClient:u})=>{const[C,o]=a.useState(""),[h,N]=a.useState(""),w=xe(),D=new z,[I,y]=a.useState(!1),n=[{key:"type",label:"Type"},{key:"parentName",label:"Client"},{key:"amount",label:"Amount"},{key:"recipient",label:"Recipient"},{key:"formattedTime",label:"Time"}],c=m=>{switch(m.toLowerCase()){case"deposit":return"success";case"profit":case"income":return"info";case"pending":return"warning";case"withdrawal":return"danger";default:return"primary"}},i=async()=>{var m;try{if(y(!0),!((m=w.currentUser)!=null&&m.email)){N("No authenticated user found");return}await je(w,w.currentUser.email,C);for(const d of r)await D.deleteActivity(d),await D.deleteNotification(d);l([]),y(!1),t(!1),g(f.filter(d=>!r.find(x=>x.id===d.id))),j(p.filter(d=>!r.find(x=>x.id===d.id)))}catch(d){N("Incorrect password"),console.error("Failed to delete selected activities:",d)}};return e.jsxs(U,{visible:s,onClose:()=>t(!1),size:"xl",alignment:"center",scrollable:!0,children:[e.jsxs(W,{children:[e.jsx(le,{className:"me-3",icon:oe,color:"red",size:"xl"}),e.jsx(Y,{style:{fontSize:"2rem"},children:"Delete Selected Activities?"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"mb-3",children:e.jsx("strong",{children:"Are you sure you want to delete the following activities?"})}),e.jsx(Q,{items:r,columns:n,columnSorter:!0,pagination:!0,itemsPerPage:10,scopedColumns:{type:m=>e.jsx("td",{children:e.jsx(_,{color:c(m.type),children:te(m.type)})}),amount:m=>e.jsx("td",{children:q(m.amount)})}}),e.jsxs("div",{className:"mt-4",children:[e.jsx("strong",{className:"d-block mb-3",children:"Please enter your password to confirm deletion:"}),e.jsxs(M,{className:"mb-3",children:[e.jsx(T,{children:e.jsx(F,{icon:Ie})}),e.jsx(R,{type:"password",placeholder:"Enter your password",value:C,onChange:m=>{o(m.target.value),N("")},invalid:!!h,autoComplete:"off"})]}),h&&e.jsx("div",{className:"text-danger mb-3",children:h})]}),e.jsx("strong",{className:"d-block mt-3 text-danger",children:"THIS ACTION IS IRREVERSIBLE."})]}),e.jsxs(X,{children:[e.jsx(v,{color:"secondary",onClick:()=>t(!1),children:"Cancel"}),e.jsx(we,{color:"danger",variant:"outline",onClick:i,disabled:!C,loading:I,children:"Confirm Delete"})]})]})},Ee=({allActivities:s,setAllActivities:t,filteredActivities:r,setFilteredActivities:l,clients:f,setClients:g,selectedClient:p,setSelectedClient:j})=>{const[u,C]=a.useState(!0),[o,h]=a.useState(!1),[N,w]=a.useState([]),[D,I]=a.useState(!1),[y,n]=a.useState(!1),[c,i]=a.useState(!1),[m,d]=a.useState([]),[x,b]=a.useState(!1),[k,B]=a.useState(void 0);if(a.useEffect(()=>{(async()=>{const E=new z,$=await E.getActivities(),ee=await E.getClients();w(ee.map(L=>({value:L.cid,label:L.firstName+" "+L.lastName})).sort((L,fe)=>L.label.localeCompare(fe.label))),l($),t($),g(ee),C(!1)})()},[]),a.useEffect(()=>{m.length>0?i(!0):i(!1)},[m]),u)return e.jsx("div",{className:"text-center",children:e.jsx(re,{color:"primary"})});const pe=[{key:"type",label:"Type",sorter:!1},{key:"parentName",label:"Client"},{label:"Time",key:"formattedTime",_style:{width:"25%"}},{key:"recipient",label:"Recipient"},{key:"amount",label:"Amount"},{key:"fund",_style:{width:"10%"}},{key:"edit",label:"",_style:{width:"1%"},filter:!1,sorter:!1},{key:"delete",label:"",_style:{width:"1%"},filter:!1,sorter:!1}],he=A=>{switch(A.toLowerCase()){case"deposit":return"success";case"profit":return"info";case"income":return"info";case"pending":return"warning";case"withdrawal":return"danger";default:return"primary"}};return e.jsxs(O,{children:[y&&e.jsx(de,{showModal:y,setShowModal:n,activity:k,selectedClient:p,setAllActivities:t,setFilteredActivities:l}),D&&e.jsx(me,{showModal:D,setShowModal:I,clients:f,activity:k,selectedClient:p,setAllActivities:t,setFilteredActivities:l}),x&&e.jsx(Te,{showModal:x,setShowModal:b,selectedActivities:m,setSelectedActivities:d,allActivities:s,setAllActivities:t,filteredActivities:r,setFilteredActivities:l,selectedClient:p}),c&&e.jsx("div",{style:{position:"fixed",bottom:"20px",left:"58%",transform:"translateX(-50%)",zIndex:999,boxShadow:"2px 5px 5px rgba(0, 0, 0, 0.2)"},children:e.jsxs(v,{style:{backgroundColor:o?"#D1464B":"#191C25",boxShadow:"2px 4px 4px rgba(0, 0, 0, 0.05)",borderColor:"#D1464B",borderWidth:"1.5px",padding:"8px 72px",fontSize:"1.1rem"},className:o?"text-light":"text-danger",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onClick:()=>b(!0),children:[e.jsx(F,{icon:ae,className:"me-2"})," Delete ",m.length," ",m.length>1?"Activities":"Activity"]})}),e.jsxs(H,{className:"justify-content-center py-3",children:[e.jsx(P,{children:e.jsx(J,{id:"client",className:"mb-3a custom-multiselect-dropdown",options:N,placeholder:"Type or select a specific client to view activities for",selectAll:!1,multiple:!1,optionsStyle:"text",allowCreateOptions:!1,onChange:async A=>{let E;A.length>0?E=A[0].value:console.log("Selections cleared"),j(E),l(E?s.filter($=>$.parentDocId===E):s)}})}),e.jsx(P,{xl:2,style:{float:"left"},children:e.jsxs(v,{color:"danger",variant:"outline",shape:"square",className:"w-100",onClick:()=>{w(A=>A.map(E=>E.value===p?{...E,selected:!1}:E)),l(s)},children:["Reset ",e.jsx(F,{icon:ve})]})})]}),e.jsx(Q,{activePage:1,cleaner:!0,clickableRows:!0,columns:pe,columnFilter:!0,columnSorter:!0,items:r,itemsPerPageSelect:!0,itemsPerPage:20,pagination:!0,sorterValue:{column:"formattedTime",state:"desc"},selectable:!0,selected:m,onSelectedItemsChange:A=>{d(A)},scopedColumns:{type:A=>e.jsx("td",{children:e.jsx(_,{color:he(A.type),children:te(A.type)})}),amount:A=>e.jsx("td",{children:q(A.amount)}),edit:A=>e.jsx("td",{className:"py-2",children:e.jsx(v,{color:"warning",variant:"outline",shape:"square",size:"sm",onClick:async()=>{B(A),I(!0)},children:"Edit"})}),delete:A=>e.jsx("td",{className:"py-2",children:e.jsx(v,{color:"danger",variant:"outline",shape:"square",size:"sm",onClick:()=>{B(A),n(!0)},children:"Delete"})})}})]})},Me=({scheduledActivities:s,setScheduledActivities:t})=>{const[r,l]=a.useState(!0),[f,g]=a.useState([]),[p,j]=a.useState(void 0),[u,C]=a.useState(!1),[o,h]=a.useState(!1),[N,w]=a.useState(void 0);if(a.useEffect(()=>{(async()=>{const c=new z,i=await c.getScheduledActivities(),m=await c.getClients();t(i),g(m),l(!1)})()},[]),r)return e.jsx("div",{className:"text-center",children:e.jsx(re,{color:"primary"})});const D=[{key:"type",label:"Type",sorter:!1},{key:"parentName",label:"Client"},{label:"Scheduled Time",key:"formattedTime",_style:{width:"20%"}},{key:"recipient",label:"Recipient"},{key:"amount",label:"Amount"},{key:"status",label:"Status",_style:{width:"8%"}},{key:"fund",_style:{width:"7%"}},{key:"edit",label:"",_style:{width:"1%"},filter:!1,sorter:!1},{key:"delete",label:"",_style:{width:"1%"},filter:!1,sorter:!1}],I=n=>{switch(n.toLowerCase()){case"deposit":return"success";case"profit":return"info";case"income":return"info";case"pending":return"warning";case"withdrawal":return"danger";case"completed":return"success";default:return"primary"}};function y(n){return n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}return e.jsxs(O,{children:[e.jsx("h1",{className:"pt-5 pb-2",children:"Scheduled Activities"}),u&&e.jsx(de,{showModal:u,setShowModal:C,activity:N,isScheduled:!0,selectedClient:p,setScheduledActivities:t}),o&&e.jsx(me,{showModal:o,setShowModal:h,clients:f,activity:N,isScheduled:!0,selectedClient:p,setScheduledActivities:t}),e.jsx(Q,{activePage:1,cleaner:!0,clickableRows:!0,columns:D,columnFilter:!0,columnSorter:!0,items:s.map(n=>({...n.activity,id:n.id,status:n.status})),itemsPerPageSelect:!0,itemsPerPage:20,pagination:!0,sorterValue:{column:"formattedTime",state:"desc"},scopedColumns:{type:n=>e.jsx("td",{children:e.jsx(_,{color:I(n.type),children:y(n.type)})}),amount:n=>e.jsx("td",{children:q(n.amount)}),status:n=>e.jsx("td",{children:e.jsx(_,{color:I(n.status),children:y(n.status)})}),edit:n=>e.jsx("td",{className:"py-2",children:e.jsx(v,{color:"warning",variant:"outline",shape:"square",size:"sm",disabled:n.status==="completed",onClick:async()=>{w(n),h(!0),j(n.parentDocId)},children:"Edit"})}),delete:n=>e.jsx("td",{className:"py-2",children:e.jsx(v,{color:"danger",variant:"outline",shape:"square",size:"sm",onClick:()=>{w(n),C(!0),j(n.parentDocId)},children:"Delete"})})}})]})},Pe=({showModal:s,setShowModal:t,clients:r,selectedClient:l,setAllActivities:f,setFilteredActivities:g,setScheduledActivities:p})=>{const j=new z,[u,C]=a.useState(ce),[o,h]=a.useState((r==null?void 0:r.find(d=>d.cid===l))??null),[N,w]=a.useState(!1),[D,I]=a.useState([]),[y,n]=a.useState(!1),c=r.map(d=>({value:d.cid,label:d.firstName+" "+d.lastName,selected:l===d.cid})).sort((d,x)=>d.label.localeCompare(x.label)),i=async()=>{if(!G(u,I)&&!y)w(!0);else{if(y&&C({...u,time:new Date}),!o){console.error("Invalid client state");return}if(u.isAmortization===!0&&!u.amortizationCreated){const[x,b]=K(u,o);let k=[];k.push(j.createActivity(x,o.cid)),k.push(j.createActivity(b,o.cid)),k.push(j.setAssets(o)),await Promise.all(k)}else await j.createActivity({...u,parentName:o.firstName+" "+o.lastName},o.cid),(u.isDividend||u.type==="manual-entry"||u.type==="deposit"||u.type==="withdrawal")&&o&&await j.setAssets(o);t(!1);const d=await j.getActivities();f(d),g(d.filter(x=>x.parentDocId===(l??o.cid)))}},m=async()=>{if(!G(u,I)&&!y)w(!0);else{if(y&&C({...u,time:new Date}),u.time<=new Date){alert("Scheduled time must be in the future.");return}if(!o){console.error("Invalid client state");return}if(u.isAmortization===!0&&!u.amortizationCreated){const[b,k]=K(u,o);await j.scheduleActivity(b,o),await j.scheduleActivity(k,o)}else await j.scheduleActivity(u,o);t(!1);const d=await j.getActivities();f(d);const x=await j.getScheduledActivities();p(x),g(d.filter(b=>b.parentDocId===(l??o.cid)))}};return a.useEffect(()=>{(async()=>{y&&await i()})()},[y]),e.jsxs(e.Fragment,{children:[N&&e.jsx(ie,{showErrorModal:N,setShowErrorModal:w,invalidInputFields:D,setOverride:n}),e.jsxs(U,{scrollable:!0,visible:s,backdrop:"static",size:"xl",alignment:"center",onClose:()=>t(!1),children:[e.jsx(W,{closeButton:!0,children:e.jsx(Y,{children:"Create New Activity"})}),e.jsx(ue,{activityState:u,setActivityState:C,clientState:o,setClientState:h,clientOptions:c}),e.jsxs(X,{children:[e.jsxs(v,{color:"primary",onClick:i,children:[e.jsx(F,{icon:Ae,className:"me-2"}),"Create"]}),e.jsxs(v,{color:"primary",variant:"outline",onClick:m,children:[e.jsx(F,{icon:ke,className:"me-2"}),"Schedule"]}),e.jsxs(v,{color:"danger",variant:"outline",onClick:()=>{t(!1)},children:[e.jsx(F,{icon:ae,className:"me-2"}),"Discard"]})]})]})]})},qe=()=>{const{t:s}=De(),[t,r]=a.useState(!1),[l,f]=a.useState([]),[g,p]=a.useState([]),[j,u]=a.useState([]),[C,o]=a.useState([]),[h,N]=a.useState();return e.jsxs("div",{children:[t&&e.jsx(Pe,{showModal:t,setShowModal:r,clients:C,selectedClient:h,setAllActivities:f,setFilteredActivities:p,setScheduledActivities:u}),e.jsx("div",{className:"d-grid gap-2 py-3",children:e.jsx(v,{color:"primary",onClick:()=>r(!0),children:"Add Activity +"})}),e.jsx(Ee,{allActivities:l,setAllActivities:f,filteredActivities:g,setFilteredActivities:p,clients:C,setClients:o,selectedClient:h,setSelectedClient:N}),e.jsx(Me,{scheduledActivities:j,setScheduledActivities:u})]})};export{qe as default};
